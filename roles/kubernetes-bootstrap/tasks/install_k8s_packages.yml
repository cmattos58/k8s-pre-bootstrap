---
- name: Add kubernetes repository
  ansible.builtin.template:
    src: 'kubernetes.repo.j2'
    dest: /etc/yum.repos.d/kubernetes.repo

- name: Install kubernetes packages
  yum:
    name: [kubelet <= 1.23.5,kubeadm <= 1.23.5,kubectl <= 1.23.5]
    disable_excludes: kubernetes

- name: Enable kubelet service
  ansible.builtin.service:
    name: kubelet
    enabled: yes

- name: Ajuste final crictl
  ansible.builtin.shell: crictl config --set runtime-endpoint=unix:///run/containerd/containerd.sock --set image-endpoint=unix:///run/containerd/containerd.sock
  #run_once: true
